sudo: required

language: node_js
before_install:
  - docker pull dsva/healthcare-application:build-cached
  - docker images
install: docker build -t travis-image -f Dockerfile.travis .
env:
  global:
    - DOCKER_EMAIL=awong.dev@gmail.com
    - DOCKER_USERNAME=awongdev
    - secure: nyOcp09Xzs9RhOF7wqRGk5yJ8e+NVXGaJVr79LvzrknZAHKrB3QMptC/rECGKTKdrwHr7Jas6/+mK36ZpIVUEF1P3EdDrsCYd6Vrgk+NS4UlgEBzCz5qnxaeLp1RA4BZ2pUVXQyavlQnRGgODiqw4C9aI4VKyaiz4QaskDH9fra/Sz8afmkwoSl0jKXn0kl+DstMrP71rJHZ31eznLC6d2AW8Y/LcA+7Abi5yq9ltDwK9h6RUB4VlTNJiis6xPyegw8OmIKIMpsnfeQpbf2oYpodxp4zLtJlr5RdXXli2zQ67mibtt/0+1dqsNQpxIdT9NU9ZucM1bBuiCbTJfd+7IURJkhz+4AU+vzenH9RNvYu5zqS/ykIhQGSi4L2QPWHJ1u++D97seJQ5BMUl85ZejdmVVhauV0AwPvrBplnZGHw6k9fuc5PZWHQGDLKynt/Jo/kHePLvbxTPGpYa+eU/uCRzdmxtJU0UBQucaj+S3Ub0mwyFpfYyOmED03AhNvodZVmLnx9EKfOq1t33+cnRYpAvvmWH0X0xtNC/HTfaBAwsrapr9mwFaZV4zIHVWqo9o70/HEvTe1/PQ0iC/N1FeKRxJ34cxTs4hUVE027wJc07jqyMs5tbn4fj2cLJXav3jGoKnS/lR9FKVl2VMoNhxr+/lMmykXTiBQ84noroww=
    - secure: MTlwhQdYS+1eky7qWiwcMBXRpI30doF+LxAgIUQZJvfkm5/a55aisp8jby3ACQiKxpKGJTYjR7JrZfhASI4O6xew05xvfLGJeCQDvLazCF+YSUevcy5kG3KkWHntbwpJ8qosu+2RlEhHlBFYCGJ6zDZu9klVsrnkaL3T+RspkbgzrIm9h8lziEuimZpWFXWazw85Ub13X6iaFX4R7tc9Lrb4FnIfSA2mb+QVOL10GpZCSiVrpGmeK8e6ZnkrHFUYFCHpceSCiY6TyA2DRBsbDvshYXJ7GwC1feLHZDmBXFjHZJalunk9HZdbgOAcpQFkBY16Txk/yHOiZVyTSH/fzRNv3oJVUtfeI+PTjs7deJveGfkeemVuaPvo8fw1CzyxD+zsqMo5uK/mTTr5tcHJGLGegKkS/5PH+ymMKgTBQrvlccNM4XepqBZ43Sc1Z2KS3O42EjCA9CmW7olIamqWyEkC8v4q2/pNZYrVHCvh55Jl5Pg1dqYO0xCf1y+YMxSgQM4JgTKKIa4jQ8mvdMoc7VXHuhTBbrNfePFOinSReLw5mLsoaqR1a+wcq8Ce7r98pJBzVogSyivBEtgESOfP5JxzoSbllFZdMOyWmceqzomPAdyG1RhUYLPrlXxc0p0dyGt3Kfw3rFbdY28Zh+q3xmnhTW3iU4SolgAmPT6qHJE= # SAUCE_USERNAME
    - secure: e8unpvXQPJObOJvw7Eo1tLK5LCAC85a8mW1lf9tJi/K8SgEHuK2dtAp5IFWYpriXOEZ1A5mman2lOyXF7gfGZfOo9FWDYqm+5pUCLWFja9t2ubWSUQCFYnh279pGoR//Iby2EcrBoV64f9vU6AdYfTP2Uk82R7g/c6URwrWCmmIxuzpKSF+zq8UWEhF0FtnSE2jtrql9tkUsuSVWKi3mdjaIGs54ZLnXQTPvndA7P4T6nE+VDnvydfPl8ABSfd03loVlptNA32iTqyvYAvG63fu/Aky/8vKN9nvOeepQMD+FBh4hxXP5TFgr10R+lrthVoMREJkjTwHvsoIKSYsZhN7bPYQbaTima/melXIOtowRrCQyUilluGYn/5SwFJdWZR3D+V6IVC+jC46to5a3X7vSN+9at4s+YibSwraD3LgSx4F6sXO/x8xyuo6GkLzCZ0QlF+29MVL3pIVh07SAJ5EjG7smcBR5lqgtpyM5UrpwvawnweG6CzQsgohVKoY7Q/WFlhiw2CG5gazihuStEZF1haKcZMG+SW+4UuVA90LvJnA6xhLA8X2/175vSzocsQi8O+NtlnNe2cCoJ5jWu08hbB/y9eQN7Pgj7QFZekcsktuu3g4HfuuLEDEzTc9xj7S+WHZFKl/mO3dhvJcgTJ5uNhKSSLIkrc2EnMTXxQc= # SAUCE_ACCESS_KEY
services:
  - docker
script:
  - docker run --rm -p 9876:9876 -e SAUCE_USERNAME -e SAUCE_ACCESS_KEY -e TRAVIS_JOB_NUMBER -it travis-image npm test
  - travis_retry docker run --rm -p 3000:3000 -e SAUCE_USERNAME -e SAUCE_ACCESS_KEY -e TRAVIS_JOB_NUMBER -it travis-image scripts/e2e-tests.sh
addons:
  sauce_connect:
    username: dsva 
    access_key:
      secure: natgIIFmbHXzyOlDrRzP7cHne2SEtgPH9/Ic4G13B3nQYSBHMkGsNXzy8Az4b+hXS3+cDD4HVO30ohWGicGOvAELbWvm6J3/Kj6CyJW5c4EmDw+kmpbyCU4aMkrUoR1zfFdZf+pgXLs6jR2/n3ENVb0VkOl/GYnYFrb1TaOy1evb1Na5/eUl1+y6ZE8isOfPvHdsr0j6nfa14FNS8tWMM2miecBD4BtvzBOJ85gzIgsaMpRPNOkiFExO15bzxs/o89COFC1ZOJpSMBjphvY2C0OmrlTbkDSYbMYOAClbyVAeVFnUIWnWhcWL9g6j09B0Fz58E7xSJS/YhpmTrdgoT8wIwv47VX1jZbIuQCfQsdUcR/0jrWLc9L0U7bmJukgsyO9KjM8NAfmDTKV0eDPwV/o+3J2tC0FrsOAuKGbE29XvuV9NIhC7oLBfJRlA4CdAdlEtl6i1WnOfS2QU7HD4pmc0SzhpKUR89vCszq6JbGuBIP4lzQTsGUoKHR/yvYB8zTJURGRFVRgQpVVgXWXjOKRXw9mAmzHuPRX07eESBJjf5jVrsBSoH0K4NebXMroNaPasjRmXDhxSSrtwpGV/RWagNKCBz6DH0fWcg0tMom4fQsAEkWB/PkrShWfT3ukGjEzdNgKWyj2QdjhVXFk0ZngacsOlMRjUghntVJcIWNk= # Saucelabs access key

notifications:
  email: false
# TODO(awong): Breaking dev deployments temporariliy until docker-based CI is stable again.
#deploy:
#  provider: script
#  script: ./scripts/release-docker.sh
#  skip_cleanup: true
#  on:
#    branch: master


